---
title: "EDA"
output: html_notebook
---

```{r}
library(tidyverse)
```

```{r}
all_EWR <- read_csv("clean_data/all_EWR.csv")
```


# GENERAL DELAYS ANALYSIS

```{r}
all_EWR %>% 
  group_by(delayed) %>% 
  summarise(n = n()) %>% 
  mutate(percent = n/sum(n))
```

```{r}
all_EWR %>% 
  ggplot(aes(x = delayed)) +
  geom_bar()
```

```{r}
all_EWR %>% 
  filter(dep_delay > 0) %>% 
  ggplot(aes(x = dep_delay)) +
  geom_histogram()
```

```{r}
all_EWR %>% 
  filter(delayed == TRUE) %>% 
  mutate(delay_period = case_when(
    dep_delay < 10 ~ "< 10min",
    dep_delay <= 60 ~ "10min - 60min",
    dep_delay > 60 ~ "> 60min"
  )) %>% 
  group_by(delay_period) %>% 
  summarise(n = n()) %>% 
  mutate(percentage = n / sum(n))
```

```{r}
month_plot_text <- all_EWR %>% 
  group_by(month, delayed) %>% 
  summarise(n = n()) %>% 
  mutate(delay_percent = round(n / sum(n) * 100)) %>% 
  filter(delayed == TRUE)
```

```{r}
all_EWR %>%
  ggplot(aes(x = fct_inorder(month), fill = delayed)) +
  geom_bar(position = "fill") +
  geom_text(aes(y = delay_percent/100 - 0.03, 
                label = str_c(delay_percent, "%")), 
            data = month_plot_text)
```

```{r}
hour_plot_text <- all_EWR %>%
  mutate(hour = if_else(hour == 1, 24, hour)) %>%
  group_by(hour, delayed) %>% 
  summarise(n = n()) %>% 
  mutate(delay_percent = round(n / sum(n) * 100)) %>% 
  filter(delayed == TRUE)
```

```{r}
all_EWR %>%
  mutate(hour = if_else(hour == 1, 24, hour)) %>%
  ggplot(aes(x = hour, fill = delayed)) +
  geom_bar(position = "fill") +
  geom_text(aes(y = delay_percent/100 - 0.03, 
                label = str_c(delay_percent, "%")), 
            data = hour_plot_text,
            size = 3)
```

```{r}
all_EWR %>% 
  ggplot(aes(x = carrier, fill = delayed)) +
  geom_bar(position = "fill")

all_EWR %>% 
filter(delayed == TRUE) %>% 
  mutate(delay_period = case_when(
    dep_delay < 10 ~ "< 10min",
    dep_delay <= 60 ~ "10min - 60min",
    dep_delay > 60 ~ "> 60min"
  )) %>%
  ggplot(aes(x = carrier, fill = delay_period)) +
  geom_bar(position = "fill")
```

```{r}
all_EWR %>% 
  ggplot(aes(x = delayed, y = distance)) +
  geom_boxplot()
```

--------------------------------------------------------------------------------


# PLANE

```{r}
all_EWR %>% 
  drop_na(year) %>% 
  filter(year != 0) %>% 
  ggplot(aes(x = delayed, y = year)) +
  geom_boxplot()
```

```{r}
all_EWR %>% 
  drop_na(manufacturer) %>% 
  ggplot(aes(x = manufacturer, fill = delayed)) +
  geom_bar() +
  coord_flip()

all_EWR %>% 
  drop_na(manufacturer) %>% 
  ggplot(aes(x = manufacturer, fill = delayed)) +
  geom_bar(position = "fill") +
  coord_flip()
```

--------------------------------------------------------------------------------

# WEATHER

```{r}
all_EWR %>% 
  drop_na(temp) %>%
  ggplot(aes(x = delayed, y = temp)) +
  geom_boxplot()

all_EWR %>% 
  drop_na(dewp) %>%
  ggplot(aes(x = delayed, y = dewp)) +
  geom_boxplot()

all_EWR %>% 
  drop_na(humid) %>%
  ggplot(aes(x = delayed, y = humid)) +
  geom_boxplot()

all_EWR %>% 
  drop_na(precip) %>%
  ggplot(aes(x = delayed, y = precip)) +
  geom_boxplot()

all_EWR %>% 
  drop_na(pressure) %>%
  ggplot(aes(x = delayed, y = pressure)) +
  geom_boxplot()
```

```{r}
all_EWR %>% 
  drop_na(wind_speed) %>%
  ggplot(aes(x = delayed, y = wind_speed)) +
  geom_boxplot()

all_EWR %>% 
  drop_na(wind_speed) %>%
  ggplot(aes(x = as.factor(wind_speed), fill = delayed)) +
  geom_bar()

all_EWR %>% 
  drop_na(wind_gust) %>%
  ggplot(aes(x = delayed, y = wind_gust)) +
  geom_boxplot()

all_EWR %>% 
  drop_na(wind_gust) %>%
  ggplot(aes(x = as.factor(wind_gust), fill = delayed)) +
  geom_bar(position = "fill")
```

```{r}
all_EWR %>% 
  drop_na(visib) %>%
  ggplot(aes(x = delayed, y = visib)) +
  geom_boxplot()

all_EWR %>% 
  drop_na(visib) %>%
  ggplot(aes(x = visib, y = dep_delay)) +
  geom_point()

all_EWR %>% 
  drop_na(visib) %>%
  ggplot(aes(x = as.factor(visib), fill = delayed)) +
  geom_bar(position = "fill")

all_EWR %>% 
  drop_na(visib) %>%
  filter(delayed == TRUE) %>% 
  mutate(delay_period = case_when(
    dep_delay < 10 ~ "< 10min",
    dep_delay <= 60 ~ "10min - 60min",
    dep_delay > 60 ~ "> 60min"
  )) %>%
  ggplot(aes(x = as.factor(visib), fill = delay_period)) +
  geom_bar(position = "fill")
```

```{r}
all_EWR %>% 
  drop_na(visib) %>% 
  mutate(visib_less_10 = if_else(visib < 10, TRUE, FALSE)) %>% 
  group_by(visib_less_10) %>% 
  summarise(n = n()) %>% 
  mutate(n/sum(n))
```

```{r}
all_EWR %>% 
  drop_na(visib) %>%
  mutate(visib_less_2 = if_else(visib < 2, TRUE, FALSE)) %>% 
  group_by(visib_less_2) %>% 
  summarise(n = n()) %>% 
  mutate(n/sum(n))
```

